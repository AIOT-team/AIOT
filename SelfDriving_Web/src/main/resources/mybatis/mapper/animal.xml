<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

	<mapper namespace="animal">
	
			<!-- 프로시저를 호출합니다.-->
			<insert id="insert" parameterType="animal" useGeneratedKeys="true" keyProperty="dno">
					call ifdactno(#{dname},#{dnum},#{dfinder},#{dimagesname},#{dlocation},#{dtime},'D');
					<!-- insert into animal (dname, dimagesname, dlocation, dtime, dnum, dfinder)
					values (#{dname}, #{dimagesname}, #{dlocation}, #{dtime}, #{dnum}, #{dfinder}); -->
			</insert>
			
			<!-- 로컬 경로에 저장되어있는 그림 미리보기 -->
			<select id="selectByDno" parameterType="int" resultType ="animal">
					select dno, dname, dnum, dfinder, dtime, dimagesname, dlocation
					from animal
					where dno = #{dno}
			</select>
			
			<!-- history 뷰 페이지 테이블 구성 관련 -->
			<select id="count" resultType="int">
				select max(dactno) from animal
			</select>
			
			<!-- history 뷰 페이지 테이블 구성 관련 -->
			<!-- group by는 사건번호로 묶는 코드-->
			<select id="selectByPage" resultType="animal">
				select dno, dname, dimagesname, dlocation, dtime, dnum, dfinder, dlevel, dactno
				from animal
                group by dactno
				order by dno desc
				limit #{startIndex}, #{rowsPerPage}
			</select>
	
			<select id="monthList" resultType="dactnoperTime">
					SELECT CONCAT(MONTH(dtime),'-', DAY(dtime)) dpertime, max(dactno)-min(dactno) as dactno FROM animal GROUP BY dpertime;
			</select>
			
			<select id="regionList" resultType="dactnoperFinder">
					select dfinder,count(distinct(dactno)) as dperfinder from animal group by dfinder;
			</select>
			
			<select id="howdanger" resultType="String">
				select min(dlevel) from animal WHERE dtime>DATE_SUB(now(),INTERVAL 1 hour);
			</select>
			
			<select id="selectByCCTV" resultType="animal">
				select dname, dlocation, dfinder, dlevel, dactno, dtime
				from animal
				where dfinder like '%cctv'
                group by dactno
				order by dtime
			</select>
			
<!-- 		<insert id="insert" parameterType="tipBoard" useGeneratedKeys="true" keyProperty="tno">
					insert into tipBoard(ttitle, tcontent, ttype, twriter, thitcount, tdate, trating, tratingcount, tratingavg, tratingsum, tattachoname, tattachsname, tattachtype)
					values (#{ttitle}, #{tcontent}, #{ttype}, #{twriter}, 0, now(6), 0,0,0,0, #{tattachoname}, #{tattachsname}, #{tattachtype})
			</insert>
			
			<select id="selectByType" resultType ="tipBoard">
					select tno, ttitle, twriter, ttype, tdate, thitcount, tratingavg
					from tipBoard
					where ttype = #{ttype}
					order by tdate desc
			</select>
			
			<select id="selectByTno" parameterType="int" resultType ="tipBoard">
					select tno, ttitle, twriter, ttype, tcontent, thitcount, tdate, tratingavg, tattachoname, tattachsname, tattachtype
					from tipBoard
					where tno = #{tno}
			</select>
			
			<select id="selectByTtitle" parameterType="int" resultType ="tipBoard">
					select tno, ttitle, twriter, ttype, tcontent, thitcount, tdate, tratingavg, tattachoname, tattachsname, tattachtype
					from tipBoard
					where ttitle = #{ttitle}
			</select>
			
			<select id="selectByPage" resultType="tipBoard">
				select tno, ttitle, twriter, ttype, thitcount, tdate, tratingavg
				from tipBoard
				order by tdate desc
				limit #{startIndex}, #{rowsPerPage}
		</select>
		
			<select id="count" resultType="int">
				select count(*) from tipBoard
			</select>
			
			<update id="updateByTno">
					update tipBoard set ttitle=#{ttitle}, tcontent=#{tcontent}, ttype=#{ttype}
					where tno=#{tno}
			</update>
			
			<update id="updateThitcountByTno">
					update tipBoard set thitcount= thitcount+1
					where tno = #{tno}
			</update>
			
			<update id="updateTratingByTno">
					update tipBoard set 
						trating = #{trating}
					where tno = #{tno}
			</update>
			
 			<update id="updateTratingCountByTno">
					update tipBoard set tratingcount = tratingcount+1
					where tno = #{tno}
			</update>
			
			<update id="updateTratingSumByTno">
					update tipBoard set tratingsum = tratingsum + #{trating}
					where tno = #{tno}
			</update>
			
			<update id="updateTratingAvgByTno">
					update tipBoard set tratingavg = tratingsum/tratingcount
					where tno = #{tno}
			</update> 
			
			<delete id="deleteByTno">
					delete from tipBoard where tno=#{tno}
			</delete> -->
	</mapper>